<html>
<head><title>Achex - Interactive Example</title>
	<link rel="stylesheet" type="text/css" href="dev.css">
</head>
<body>
	<!-- Achex WebSocketServer Banner -->
	<a href="http://achex.ca/" 
		style="background:#555;
		color:#ddd;border-radius:3px;padding:0px 10px 0px 10px;
		text-decoration:none;
		font-family:Arial;letter-spacing:1px;font-size:12px;">
		Powered by Achex WebSocketServer
	</a><br><br>
	<!-- Achex WebSocketServer Banner -->

	Achex WebSocketServer <br>- javascript interface example -<br>
<div style="width:260px;">
	<hr>
</div>

	<!-- User Input -->
	<input id="userinput" type="text" value="ping"><a href="javascript:send()">SEND</a> &nbsp;<a href="javascript:disc()" id="disc">DISCONNECT</a>

	<!-- Log display -->
	<div id="mylog"><br>
	<br><br>Received:<br></div>

	<!-- WEBSOCKET SIMPLE SCRIPT -->
	<script type="text/javascript">
	var ono=0;
	var onm=0;
	var one=0;
	var onc=0;
	var ons=0;
	var onmake=0;

	// --- LOG ---
	//***************************
	// get log object from html 
	var logdiv = document.getElementById('mylog');

	// make a simplified log function
	function logf(str){
		logdiv.innerHTML += str + '<br>';
	}
	//***************************

	// --- WEBSOCKET ---
	//***************************
	// make new conncetion
	var ws;

	function wsOpen(){
		onmake = 16;
		ws = new WebSocket('ws://achex.ca:4010');

		// add event handler for incomming message
		ws.onmessage = function(evt){
			onm=16;
			var my_received_message = evt.data;
			logf('<font color="#9aa">received:</font> ' + my_received_message);
		};

		// add event handler for diconnection 
		ws.onclose= function(evt){
			onc=16;
			logf('log: Diconnected');
		};

		// add event handler for error 
		ws.onerror= function(evt){
			one=16;
			logf('log: Error');
		};

		// add event handler for new connection 
		ws.onopen= function(evt){
			ono=16;
			logf('log: Connected');
			ws.send('{"setID":"PcatChat","passwd":"50-61-74-72-69-63-6b"}');
		};
	}
	setTimeout(wsOpen,500);

	// make a simple send function
	function send(){
		ons=16;
		var input = document.getElementById('userinput');
		// send content of input field into websocket
		if(input.value !== ''){
			logf('<font color="#caa">sent:</font> '+input.value);
			ws.send('{"to":"PcatChat","mess":"'+input.value+'"}');
		}else{
			logf('<font color="#b90">empty imput</font>');
		}
		// erase input field
		input.value = '';
	}
	function disc(){
		if(ws.readyState == 1){
			ws.close();
			document.getElementById('disc').innerHTML = 'CONNECT';
		}else{
			wsOpen();
			document.getElementById('disc').innerHTML = 'DISCONNECT';
		}
	}

	</script>

</body>
</html>
